// Configurazione
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz-MAsBPFZ6Em60caPkTVO5QAaYBeyQD306EydKvtzgxNrOZYNRGUUvidbqI09EqYQ_xg/exec";

// Funzione principale per l'invio
async function inviaDati() {
  const date = document.getElementById("date").value;
  const time = document.getElementById("time").value;
  const text = document.getElementById("text").value;
  const letter = document.getElementById("letter").value;
  const table = document.getElementById("table").value.padStart(2, '0');
  const note = document.getElementById("note").value;
  
  const dataString = `${date};${time};${text};${letter};${table};${note}`;
  
  try {
    const response = await fetch(GOOGLE_SCRIPT_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain' },
      body: dataString
    });
    
    const result = await response.json();
    
    if (result.status === 'success') {
      alert('Dati salvati con successo!');
      document.getElementById("note").value = ""; // Resetta solo le note
    } else {
      throw new Error(result.message);
    }
    
  } catch (error) {
    console.error("Errore:", error);
    alert(`Errore nell'invio: ${error.message}`);
  }
}

// Collega il bottone
document.getElementById("sendData").addEventListener("click", inviaDati);

// Funzionalit√† QR Scanner (rimane identica)
const scanner = new Html5QrcodeScanner('reader', { 
  qrbox: { width: 250, height: 250 }, 
  fps: 10 
});

scanner.render(onScanSuccess, console.error);

function onScanSuccess(result) {
  const parts = result.split(";");
  if (parts.length === 6 && parts[0] === "INI" && parts[5] === "END") {
    document.getElementById("date").value = parts[1];
    document.getElementById("time").value = parts[2];
    document.getElementById("text").value = parts[3];
    document.getElementById("letter").value = parts[4];
    scanner.clear();
  }
}
